<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marathon Live Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+KR:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0d0d;
  --surface: #161616;
  --card: #1a1a1a;
  --border: #272727;
  --red: #e8001c;
  --green: #00e676;
  --yellow: #ffd600;
  --blue: #40c4ff;
  --text: #f0f0f0;
  --muted: #555;
  --sub: #888;
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body { background:var(--bg); color:var(--text); font-family:'Noto Sans KR',sans-serif; min-height:100vh; }

/* HEADER */
header {
  background:var(--surface); border-bottom:2px solid var(--red);
  padding:10px 14px; display:flex; align-items:center; justify-content:space-between;
  position:sticky; top:0; z-index:200;
}
.logo { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:3px; }
.logo span { color:var(--red); }
.live-badge { display:flex; align-items:center; gap:5px; font-size:10px; font-weight:700; color:var(--red); letter-spacing:2px; }
.live-dot { width:7px; height:7px; background:var(--red); border-radius:50%; box-shadow:0 0 6px var(--red); animation:blink 1.4s infinite; }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

/* EVENT SELECT */
.event-screen { max-width:500px; margin:0 auto; padding:24px 14px; }
.event-title { font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:3px; color:var(--muted); margin-bottom:16px; }
.event-buttons { display:flex; flex-direction:column; gap:10px; }
.event-btn {
  background:var(--card); border:1px solid var(--border); border-radius:12px;
  padding:16px 18px; text-align:left; cursor:pointer; transition:all .2s;
  display:flex; align-items:center; justify-content:space-between;
}
.event-btn:hover, .event-btn:active { border-color:var(--red); background:#221010; }
.event-btn-name { font-weight:700; font-size:16px; }
.event-btn-sub { font-size:12px; color:var(--muted); margin-top:3px; }
.event-btn-arrow { color:var(--muted); font-size:18px; }

.divider-or {
  text-align:center; font-size:11px; color:var(--muted);
  margin:20px 0; letter-spacing:2px;
  display:flex; align-items:center; gap:10px;
}
.divider-or::before, .divider-or::after {
  content:''; flex:1; border-top:1px solid var(--border);
}

.manual-input { display:flex; gap:8px; }
input {
  flex:1; background:var(--surface); border:1px solid var(--border); border-radius:10px;
  padding:11px 13px; color:var(--text); font-family:'Noto Sans KR',sans-serif; font-size:14px; outline:none;
}
input:focus { border-color:var(--red); }
input::placeholder { color:var(--muted); }
.btn {
  background:var(--red); color:#fff; border:none; border-radius:10px;
  padding:11px 18px; font-family:'Bebas Neue',sans-serif; font-size:15px;
  letter-spacing:1px; cursor:pointer; white-space:nowrap;
}
.btn:disabled { background:#333; color:#555; }

.status { font-size:12px; padding:8px 12px; border-radius:8px; margin-top:10px; display:none; }
.s-loading { background:#1a1a40; color:#818cf8; border:1px solid #3730a3; display:block; }
.s-success { background:#052e16; color:var(--green); border:1px solid #166534; display:block; }
.s-error   { background:#1f0a0a; color:#f87171; border:1px solid #991b1b; display:block; }

/* BOARD */
#board { display:none; }

.board-bar {
  padding:8px 14px; display:flex; align-items:center; justify-content:space-between;
  border-bottom:1px solid var(--border); margin-bottom:8px; position:sticky; top:42px; 
  background:var(--bg); z-index:100;
}
.board-info { display:flex; align-items:baseline; gap:8px; }
.board-event-name { font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:2px; color:var(--text); }
.board-count { font-size:12px; color:var(--muted); }
.board-time { font-size:10px; color:var(--muted); }
.board-actions { display:flex; gap:6px; }
.btn-xs {
  background:transparent; border:1px solid var(--border); color:var(--sub);
  border-radius:7px; padding:5px 10px; font-size:11px; cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;
}
.btn-xs:hover { border-color:var(--red); color:var(--red); }

/* CATEGORY SECTION */
.cat-section { margin-bottom:16px; }
.cat-header {
  font-family:'Bebas Neue',sans-serif; font-size:12px; letter-spacing:3px;
  color:var(--muted); padding:6px 14px 6px; 
}
.runner-list { display:flex; flex-direction:column; gap:6px; padding:0 10px; }

/* COMPACT CARD */
.rcard {
  background:var(--card); border:1px solid var(--border); border-radius:10px;
  overflow:hidden; position:relative;
}
.rcard.finished { border-left:3px solid var(--green); }
.rcard.running  { border-left:3px solid var(--red); }
.rcard.waiting  { border-left:3px solid var(--muted); }

/* ë©”ì¸ í–‰: í•œ ì¤„ì— ì´ë¦„+ìƒíƒœ+ê¸°ë¡ */
.card-row {
  display:grid;
  grid-template-columns: 1fr auto;
  align-items:center;
  padding:9px 12px 9px 14px;
  gap:10px;
  cursor:pointer;
  user-select:none;
}

.card-left {}
.card-name-row { display:flex; align-items:center; gap:6px; margin-bottom:2px; }
.card-name { font-weight:700; font-size:15px; }
.cat-badge {
  font-size:9px; font-weight:700; padding:1px 5px; border-radius:3px;
}
.cat-full { background:#7f1d1d; color:#fca5a5; }
.cat-half { background:#1e3a5f; color:#93c5fd; }
.cat-10k  { background:#14532d; color:#86efac; }

.card-sub { font-size:11px; color:var(--muted); display:flex; align-items:center; gap:8px; }
.card-bib { }
.card-status { }
.pace-val { color:var(--yellow); font-weight:600; }
.sep { color:var(--border); }

.card-right { text-align:right; }
.time-label { font-size:9px; color:var(--muted); letter-spacing:1px; }
.time-value {
  font-family:'Bebas Neue',sans-serif; font-size:26px;
  letter-spacing:1px; color:var(--green); line-height:1;
}
.time-value.dim { color:var(--muted); font-size:18px; }

/* SPLITS (í¼ì¹˜ê¸°) */
.card-splits { display:none; padding:0 12px 10px 14px; }
.splits-scroll { display:flex; gap:4px; overflow-x:auto; padding-bottom:2px; }
.splits-scroll::-webkit-scrollbar { height:3px; }
.splits-scroll::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.split-cell {
  background:var(--surface); border:1px solid var(--border); border-radius:6px;
  padding:5px 6px; text-align:center; flex-shrink:0; min-width:42px;
}
.split-cell.reached { background:#0f2a1a; border-color:#1a4a2a; }
.split-cell.latest  { border-color:var(--red); background:#1c1010; }
.sp-km   { font-size:8px; color:var(--muted); font-weight:700; }
.sp-pace { font-size:11px; font-weight:700; color:var(--green); margin:2px 0; }
.sp-pace.empty { color:var(--border); }
.sp-time { font-size:8px; color:var(--sub); }

.detail-link {
  font-size:10px; color:var(--muted); text-decoration:none;
  border:1px solid var(--border); border-radius:5px; padding:2px 7px;
  display:inline-block; margin-top:6px;
}

/* ìŠ¤ì¼ˆë ˆí†¤ */
.skel {
  background:linear-gradient(90deg,var(--surface) 25%,#222 50%,var(--surface) 75%);
  background-size:200% 100%; animation:shimmer 1.4s infinite;
  border-radius:5px; height:12px; display:inline-block;
}
@keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
</style>
</head>
<body>

<header>
  <div class="logo">MARATHON <span>LIVE</span></div>
  <div class="live-badge"><div class="live-dot"></div>LIVE</div>
</header>

<!-- ëŒ€íšŒ ì„ íƒ í™”ë©´ -->
<div class="event-screen" id="eventScreen">
  <div class="event-title">ëŒ€íšŒ ì„ íƒ</div>
  <div class="event-buttons" id="eventButtons"></div>

  <div class="divider-or">ì§ì ‘ ì…ë ¥</div>

  <div class="manual-input">
    <input id="sheetInput" type="text" placeholder="êµ¬ê¸€ ì‹œíŠ¸ ID ë˜ëŠ” URL">
    <button class="btn" id="startBtn" onclick="loadSheet()">ì‹œì‘</button>
  </div>
  <div id="setupStatus" class="status"></div>
</div>

<!-- ë¦¬ë”ë³´ë“œ -->
<div id="board">
  <div class="board-bar">
    <div class="board-info">
      <div class="board-event-name" id="boardEventName"></div>
      <div class="board-count" id="boardCount"></div>
    </div>
    <div style="display:flex;align-items:center;gap:8px;">
      <div class="board-time" id="lastUpdate"></div>
      <div class="board-actions">
        <button class="btn-xs" onclick="fetchAll()">ğŸ”„</button>
        <button class="btn-xs" onclick="goHome()">â† ëª©ë¡</button>
      </div>
    </div>
  </div>
  <div id="boardInner"></div>
</div>

<script>
// ================================================================
// âœï¸ ëŒ€íšŒ ëª©ë¡ â€” ì¶”ê°€/ìˆ˜ì • ì—¬ê¸°ì„œ!
// ================================================================
const EVENTS = [
  {
    name: '2026 ì„œìš¸ ë™ì•„ë§ˆë¼í†¤',
    date: '2026.03.15',
    sheetId: '1C7o_xy3Tj1YQa2PC0JZOmXpS1zHTfAAXLl7WPCB4qUU',
  },
];
// ================================================================

const BASE = 'https://smartchip.co.kr/return_data_livephoto.asp';
const KMS  = [5, 10, 15, 20, 25, 30, 35, 40, 42.2];
const PROXIES = [
  url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
  url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
  url => `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`,
];

let eventCode   = '';
let currentEventName = '';
let runners     = [];
let runnerData  = {};
let proxyIdx    = 0;
let fetchedCount = 0;
let refreshTimer = null;

// â”€â”€ ëŒ€íšŒ ë²„íŠ¼ ë Œë” â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('eventButtons');
  if (EVENTS.length === 0) {
    container.innerHTML = '<div style="font-size:12px;color:var(--muted);padding:8px 0;">ë“±ë¡ëœ ëŒ€íšŒê°€ ì—†ì–´ìš”.<br>ì•„ë˜ ì§ì ‘ ì…ë ¥ ë˜ëŠ” íŒŒì¼ ë‚´ EVENTS ë°°ì—´ì— ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
    return;
  }
  EVENTS.forEach((ev, i) => {
    const btn = document.createElement('button');
    btn.className = 'event-btn';
    btn.innerHTML = `
      <div>
        <div class="event-btn-name">${ev.name}</div>
        ${ev.date ? `<div class="event-btn-sub">${ev.date}</div>` : ''}
      </div>
      <div class="event-btn-arrow">â€º</div>
    `;
    btn.onclick = () => loadEventByIndex(i);
    container.appendChild(btn);
  });
});

async function loadEventByIndex(i) {
  const ev = EVENTS[i];
  document.getElementById('sheetInput').value = ev.sheetId;
  currentEventName = ev.name;
  await loadSheet();
}

// â”€â”€ í™ˆìœ¼ë¡œ â”€â”€
function goHome() {
  clearInterval(refreshTimer);
  document.getElementById('board').style.display = 'none';
  document.getElementById('eventScreen').style.display = 'block';
}

// â”€â”€ í”„ë¡ì‹œ fetch â”€â”€
async function proxyFetch(targetUrl) {
  for (let i = 0; i < PROXIES.length; i++) {
    const idx = (proxyIdx + i) % PROXIES.length;
    try {
      const res = await fetch(PROXIES[idx](targetUrl), { signal: AbortSignal.timeout(12000) });
      if (!res.ok) throw new Error();
      const ct = res.headers.get('content-type') || '';
      if (ct.includes('json')) {
        const j = await res.json();
        proxyIdx = idx;
        return j.contents || j.body || '';
      }
      const text = await res.text();
      proxyIdx = idx;
      return text;
    } catch(e) {}
  }
  throw new Error('í”„ë¡ì‹œ ì‹¤íŒ¨');
}

// â”€â”€ ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° â”€â”€
function extractId(s) {
  const m = s.match(/\/spreadsheets\/d\/([a-zA-Z0-9\-_]+)/);
  return m ? m[1] : s.trim();
}

async function loadSheet() {
  const raw = document.getElementById('sheetInput').value.trim();
  if (!raw) return;
  const id = extractId(raw);
  setStatus('loading', 'â³ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
  document.getElementById('startBtn').disabled = true;

  try {
    const res = await fetch(`https://docs.google.com/spreadsheets/d/${id}/export?format=csv&gid=0`);
    if (!res.ok) throw new Error();
    const text = await res.text();
    const rows = text.trim().split('\n')
      .map(r => r.split(',').map(c => c.trim().replace(/"/g,'')));

    eventCode = rows[0][0];
    runners   = rows.filter(r => r[1]).map(r => ({ name: r[1], bib: r[2]||'', cat: r[3]||'' }));
    if (!eventCode || !runners.length) throw new Error();

    if (!currentEventName) currentEventName = rows[0][1] || 'ë§ˆë¼í†¤';

    setStatus('success', `âœ… ${runners.length}ëª…`);
    setTimeout(initBoard, 500);
  } catch {
    setStatus('error', 'âŒ ì‹¤íŒ¨. ì‹œíŠ¸ ê³µìœ (ë§í¬ ë·°ì–´) í™•ì¸í•´ì£¼ì„¸ìš”.');
    document.getElementById('startBtn').disabled = false;
  }
}

function setStatus(type, msg) {
  const el = document.getElementById('setupStatus');
  el.className = 'status s-' + type;
  el.textContent = msg;
}

// â”€â”€ ë³´ë“œ ì´ˆê¸°í™” â”€â”€
function initBoard() {
  document.getElementById('eventScreen').style.display = 'none';
  document.getElementById('board').style.display = 'block';
  document.getElementById('boardEventName').textContent = currentEventName;
  document.getElementById('boardCount').textContent = `${runners.length}ëª…`;
  renderSkeletons();
  fetchAll();
  clearInterval(refreshTimer);
  refreshTimer = setInterval(fetchAll, 30000);
}

// â”€â”€ ìŠ¤ì¼ˆë ˆí†¤ â”€â”€
function renderSkeletons() {
  const cats = [...new Set(runners.map(r => r.cat || 'unknown'))];
  const inner = document.getElementById('boardInner');
  inner.innerHTML = '';

  cats.forEach(cat => {
    const group = runners.filter(r => (r.cat||'unknown') === cat);
    const sec = document.createElement('div');
    sec.className = 'cat-section';
    sec.id = 'section-' + cat;
    const label = catLabel(cat);
    sec.innerHTML = (cats.length > 1 && cat !== 'unknown')
      ? `<div class="cat-header">${label} Â· ${group.length}ëª…</div><div class="runner-list" id="list-${cat}"></div>`
      : `<div class="runner-list" id="list-${cat}"></div>`;
    inner.appendChild(sec);

    const list = sec.querySelector('.runner-list');
    list.innerHTML = group.map(r => `
      <div class="rcard waiting" id="card-${eid(r.name)}">
        <div class="card-row">
          <div class="card-left">
            <div class="card-name-row">
              <span class="card-name">${r.name}</span>
              ${r.cat ? `<span class="cat-badge ${catCls(r.cat)}">${r.cat}</span>` : ''}
            </div>
            <div class="card-sub">
              <span class="card-bib">${r.bib ? 'BIB '+r.bib : ''}</span>
              <span class="skel" style="width:60px;"></span>
            </div>
          </div>
          <div class="card-right">
            <div class="time-label">NET TIME</div>
            <div class="time-value dim">--:--</div>
          </div>
        </div>
      </div>
    `).join('');
  });
}

// â”€â”€ ì „ì²´ ê°±ì‹  â”€â”€
function fetchAll() {
  updateTime();
  fetchedCount = 0;
  runners.forEach((r, i) => setTimeout(() => fetchRunner(r), i * 300));
}

// â”€â”€ ê°œë³„ fetch â”€â”€
async function fetchRunner(runner) {
  const query = runner.bib || runner.name;
  const url = `${BASE}?nameorbibno=${encodeURIComponent(query)}&usedata=${eventCode}`;
  try {
    const html = await proxyFetch(url);
    const data = parseHTML(html, runner);
    runnerData[runner.name] = data;
    renderCard(runner, data);
  } catch {
    runnerData[runner.name] = null;
    renderCard(runner, null);
  }
  fetchedCount++;
  if (fetchedCount >= runners.length) sortCards();
}

// â”€â”€ HTML íŒŒì‹± â”€â”€
function parseHTML(html, runner) {
  const doc = new DOMParser().parseFromString(html, 'text/html');
  const text = doc.body ? doc.body.innerText : html;
  if (!text || text.includes('ë°°ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”') || text.trim().length < 50) return null;

  const d = {};
  const hm = text.match(/([^\s\n]+)\s+(Full|Half|10K|10k|5K|5k)\s+BIB\s+(\d+)/);
  if (hm) { d.name=hm[1]; d.category=hm[2]; d.bib=hm[3]; }

  const pm = text.match(/Pace\s+([\d:]+)\s+min\/km/);
  const sm = text.match(/Speed\s+([\d.]+)\s+km\/h/);
  d.pace  = pm ? pm[1] : null;
  d.speed = sm ? sm[1] : null;

  d.splits = [];
  doc.querySelectorAll('table').forEach(table => {
    const rows = table.querySelectorAll('tr');
    let ptRow, tmRow, pcRow;
    rows.forEach(row => {
      const cells = [...row.querySelectorAll('td,th')].map(c => c.innerText.trim());
      if (cells[0]==='POINT') ptRow=cells.slice(1);
      if (cells[0]==='TIME' && !tmRow) tmRow=cells.slice(1);
      if (cells[0]==='PACE') pcRow=cells.slice(1);
    });
    if (ptRow && tmRow) {
      ptRow.forEach((pt,i) => {
        const km = parseFloat(pt);
        if (!isNaN(km)) d.splits.push({ km, time:tmRow[i]||'', pace:pcRow?(pcRow[i]||''):'' });
      });
    }
  });

  const reached = d.splits.filter(s => s.time && s.time.trim() && s.time!=='--');
  d.lastSplit = reached.slice(-1)[0] || null;
  d.finished  = d.splits.some(s => s.km>=42 && s.time && s.time.trim());
  const fin   = d.splits.find(s => s.km>=42.2);
  d.finalTime = fin ? fin.time : (d.lastSplit ? d.lastSplit.time : null);
  return d;
}

// â”€â”€ ì¹´ë“œ ë Œë” â”€â”€
function renderCard(runner, d) {
  const el = document.getElementById(`card-${eid(runner.name)}`);
  if (!el) return;
  const query = runner.bib || runner.name;
  const url = `${BASE}?nameorbibno=${encodeURIComponent(query)}&usedata=${eventCode}`;
  const cid = eid(runner.name);
  const cat = d?.category || runner.cat || '';

  if (!d) {
    el.className = 'rcard waiting';
    el.innerHTML = `
      <div class="card-row">
        <div class="card-left">
          <div class="card-name-row"><span class="card-name">${runner.name}</span>${cat?`<span class="cat-badge ${catCls(cat)}">${cat}</span>`:''}</div>
          <div class="card-sub"><span style="color:var(--muted)">ëŒ€ê¸° ì¤‘</span></div>
        </div>
        <div class="card-right">
          <div class="time-label">NET TIME</div>
          <div class="time-value dim">--:--</div>
        </div>
      </div>`;
    return;
  }

  const statusTxt = d.finished ? 'ğŸ ì™„ì£¼' : (d.lastSplit ? `ğŸ“ ${d.lastSplit.km}km` : 'ğŸƒ');
  el.className = `rcard ${d.finished?'finished':'running'}`;
  el.innerHTML = `
    <div class="card-row" onclick="toggleSplits('${cid}')">
      <div class="card-left">
        <div class="card-name-row">
          <span class="card-name">${runner.name}</span>
          ${cat?`<span class="cat-badge ${catCls(cat)}">${cat}</span>`:''}
        </div>
        <div class="card-sub">
          ${d.bib||runner.bib ? `<span class="card-bib">#${d.bib||runner.bib}</span><span class="sep">Â·</span>` : ''}
          <span class="card-status">${statusTxt}</span>
          ${d.pace ? `<span class="sep">Â·</span><span class="pace-val">${d.pace}</span>` : ''}
        </div>
      </div>
      <div class="card-right">
        <div class="time-label">${d.finished?'FINISH':'NET TIME'}</div>
        <div class="time-value ${d.finalTime?'':'dim'}">${d.finalTime||'--:--'}</div>
      </div>
    </div>
    <div class="card-splits" id="splits-${cid}">
      <div class="splits-scroll">${buildSplits(d.splits)}</div>
      <a class="detail-link" href="${url}" target="_blank">ìŠ¤ë§ˆíŠ¸ì¹© ìƒì„¸ â†—</a>
    </div>
  `;
}

// â”€â”€ êµ¬ê°„ HTML â”€â”€
function buildSplits(splits) {
  if (!splits?.length) return '<span style="font-size:11px;color:var(--muted)">êµ¬ê°„ ì—†ìŒ</span>';
  const reached = splits.filter(s => s.time?.trim() && s.time!=='--');
  const latestKm = reached.length ? reached.slice(-1)[0].km : -1;
  const map = {};
  splits.forEach(s => map[s.km]=s);
  return KMS.map(km => {
    const s = map[km]||{km,time:'',pace:''};
    const has = !!(s.time?.trim() && s.time!=='--');
    const cls = s.km===latestKm ? 'split-cell latest' : (has?'split-cell reached':'split-cell');
    return `<div class="${cls}">
      <div class="sp-km">${km}k</div>
      <div class="sp-pace ${has?'':'empty'}">${s.pace||'â€“'}</div>
      <div class="sp-time">${s.time||'â€“'}</div>
    </div>`;
  }).join('');
}

// â”€â”€ êµ¬ê°„ í† ê¸€ â”€â”€
function toggleSplits(cid) {
  const panel = document.getElementById(`splits-${cid}`);
  if (!panel) return;
  panel.style.display = panel.style.display==='block' ? 'none' : 'block';
}

// â”€â”€ ì •ë ¬ â”€â”€
function timeToSec(t) {
  if (!t || t.includes('-') || !t.trim()) return 99999;
  const p = t.trim().split(':').map(Number);
  return p.length===3 ? p[0]*3600+p[1]*60+p[2] : p[0]*60+p[1];
}

function sortCards() {
  const cats = [...new Set(runners.map(r => r.cat||'unknown'))];
  cats.forEach(cat => {
    const listEl = document.getElementById('list-'+cat);
    if (!listEl) return;
    const group = runners.filter(r => (r.cat||'unknown')===cat);
    const cards = [...listEl.children];
    cards.sort((a,b) => {
      const ra = group.find(r => eid(r.name)===a.id.replace('card-',''));
      const rb = group.find(r => eid(r.name)===b.id.replace('card-',''));
      if (!ra||!rb) return 0;
      const da = runnerData[ra.name], db = runnerData[rb.name];
      const sa = da ? (da.finished?0:(da.lastSplit?1:2)) : 3;
      const sb = db ? (db.finished?0:(db.lastSplit?1:2)) : 3;
      if (sa!==sb) return sa-sb;
      if (sa===0) return timeToSec(da.finalTime)-timeToSec(db.finalTime);
      if (sa===1) {
        const ka = da.lastSplit?.km||0, kb = db.lastSplit?.km||0;
        if (ka!==kb) return kb-ka;
        return timeToSec(da.pace)-timeToSec(db.pace);
      }
      return 0;
    });
    cards.forEach(c => listEl.appendChild(c));
  });
}

// â”€â”€ ìœ í‹¸ â”€â”€
function eid(n) { return encodeURIComponent(n).replace(/%/g,'_'); }
function catCls(c) { return {Full:'cat-full',Half:'cat-half','10K':'cat-10k','10k':'cat-10k'}[c]||'cat-full'; }
function catLabel(c) { return {Full:'í’€ì½”ìŠ¤',Half:'í•˜í”„',unknown:'ì „ì²´'}[c]||c; }

function goHome() {
  clearInterval(refreshTimer);
  currentEventName = '';
  document.getElementById('board').style.display = 'none';
  document.getElementById('eventScreen').style.display = 'block';
  document.getElementById('startBtn').disabled = false;
  setStatus('','');
}

function updateTime() {
  const now = new Date();
  const t = [now.getHours(),now.getMinutes(),now.getSeconds()].map(n=>String(n).padStart(2,'0')).join(':');
  document.getElementById('lastUpdate').textContent = `${t} Â· 30ì´ˆ ìë™`;
}
</script>
</body>
</html>
